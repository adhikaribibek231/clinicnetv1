{% extends 'products/base.html' %}

{% block content %}
<section>
    <h2>Welcome to Pharmacy Management System</h2>
    <p>Manage your pharmacy inventory, sales, and receipts efficiently with our comprehensive system.</p>
    
    <div class="grid">
        <div class="card">
            <h3>Total Products</h3>
            <p>{{ total_products }} items in inventory</p>
        </div>
        <div class="card">
            <h3>Total Sales</h3>
            <p>{{ total_sales }} transactions completed</p>
        </div>
        <div class="card">
            <h3>Inventory Value</h3>
            <p>Rs. {{ total_value|floatformat:2 }}</p>
        </div>
    </div>
</section>

<section>
    <h2>Quick Actions</h2>
    <div class="row">
        <div class="col-md-4 mb-3">
            <div class="card shadow-sm h-100">
                <div class="card-body text-center">
                    <h5 class="card-title"><i class="fas fa-boxes fa-lg text-primary"></i> View Inventory</h5>
                    <p class="card-text text-muted">Check all items currently in stock</p>
                    <a href="{% url 'pharmacy:index' %}" class="btn btn-primary btn-lg w-100 mt-2">
                        <i class="fas fa-clipboard-list"></i> View Inventory
                    </a>
                </div>
            </div>
        </div>
        <div class="col-md-4 mb-3">
            <div class="card shadow-sm h-100">
                <div class="card-body text-center">
                    <h5 class="card-title"><i class="fas fa-receipt fa-lg text-success"></i> View Receipts</h5>
                    <p class="card-text text-muted">Check all transaction receipts</p>
                    <a href="{% url 'pharmacy:receipt' %}" class="btn btn-success btn-lg w-100 mt-2">
                        <i class="fas fa-file-invoice-dollar"></i> View Receipts
                    </a>
                </div>
            </div>
        </div>
        <div class="col-md-4 mb-3">
            <div class="card shadow-sm h-100">
                <div class="card-body text-center">
                    <h5 class="card-title"><i class="fas fa-chart-line fa-lg text-info"></i> Sales Report</h5>
                    <p class="card-text text-muted">View detailed sales information</p>
                    <a href="{% url 'pharmacy:all_sales' %}" class="btn btn-info btn-lg w-100 mt-2">
                        <i class="fas fa-chart-bar"></i> View Sales
                    </a>
                </div>
            </div>
        </div>
        {% if request.user.is_staff %}
        <div class="col-md-4 mb-3">
            <div class="card shadow-sm h-100">
                <div class="card-body text-center">
                    <h5 class="card-title"><i class="fas fa-vials fa-lg text-warning"></i> Lab Test Module</h5>
                    <p class="card-text text-muted">Access and record lab test results</p>
                    <a href="{% url 'labtest:lab_analysis_form' %}" class="btn btn-warning btn-lg w-100 mt-2">
                        <i class="fas fa-flask"></i> Go to Lab Test
                    </a>
                </div>
            </div>
        </div>
        <div class="col-md-4 mb-3">
            <div class="card shadow-sm h-100">
                <div class="card-body text-center">
                    <h5 class="card-title"><i class="fas fa-file-medical fa-lg text-secondary"></i> Lab Reports</h5>
                    <p class="card-text text-muted">View all patients' lab reports</p>
                    <a href="{% url 'labtest:lab_reports_list' %}" class="btn btn-secondary btn-lg w-100 mt-2">
                        <i class="fas fa-file-alt"></i> Go to Lab Reports
                    </a>
                </div>
            </div>
        </div>
        {% endif %}
    </div>
</section>

{% if expiring_batches %}
<section>
    <h2>Expiring Soon Medicines</h2>
    <div class="table-container">
        <table class="table table-striped table-hover">
            <thead>
                <tr>
                    <th>Medicine Name</th>
                    <th>Batch Number</th>
                    <th>Expiry Date</th>
                    <th>Quantity</th>
                    <th>Unit Price (Rs.)</th>
                    <th>Action</th>
                </tr>
            </thead>
            <tbody>
                {% for batch in expiring_batches %}
                <tr>
                    <td>{{ batch.product.item_name }}</td>
                    <td>{{ batch.batch_number|default:'-' }}</td>
                    <td>{{ batch.expiry_date|date:'Y-m-d' }}</td>
                    <td>{{ batch.quantity }}</td>
                    <td>Rs. {{ batch.product.unit_price }}</td>
                    <td>
                        <a href="{% url 'pharmacy:product_detail' batch.product.id %}" class="btn-placeholder">View Details</a>
                    </td>
                </tr>
                {% endfor %}
            </tbody>
        </table>
    </div>
</section>
{% endif %}
{% endblock %}
