{% extends 'clinic_base.html' %}
{% load static %}

{% block title %}Emergency Patient Registration - ClinicNet{% endblock %}

{% block extra_css %}
<style>
    .registration-form {
        background: white;
        border-radius: 15px;
        padding: 2rem;
        box-shadow: 0 4px 15px rgba(0, 0, 0, 0.1);
        margin-bottom: 2rem;
    }

    .form-section {
        border: 1px solid #e9ecef;
        border-radius: 10px;
        padding: 1.5rem;
        margin-bottom: 1.5rem;
    }

    .section-title {
        color: #2c3e50;
        font-weight: bold;
        margin-bottom: 1rem;
        padding-bottom: 0.5rem;
        border-bottom: 2px solid #3498db;
        display: inline-block;
    }

    .priority-critical {
        background: #fdf2f2;
        border-color: #e74c3c;
    }

    .priority-urgent {
        background: #fef9e7;
        border-color: #f39c12;
    }

    .priority-stable {
        background: #f0f9f0;
        border-color: #27ae60;
    }

    .vital-signs-grid {
        display: grid;
        grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
        gap: 1rem;
    }

    .vital-sign-item {
        background: #f8f9fa;
        padding: 1rem;
        border-radius: 8px;
        border-left: 4px solid #3498db;
    }

    .btn-emergency {
        background: linear-gradient(135deg, #ff6b6b 0%, #ee5a24 100%);
        color: white;
        border: none;
        padding: 12px 30px;
        border-radius: 25px;
        font-weight: 600;
        transition: all 0.3s ease;
    }

    .btn-emergency:hover {
        transform: translateY(-2px);
        box-shadow: 0 5px 15px rgba(255, 107, 107, 0.3);
        color: white;
    }

    .btn-secondary-custom {
        background: #6c757d;
        color: white;
        border: none;
        padding: 12px 30px;
        border-radius: 25px;
        font-weight: 600;
        transition: all 0.3s ease;
    }

    .btn-secondary-custom:hover {
        background: #5a6268;
        color: white;
        text-decoration: none;
    }

    .alert-emergency {
        background: linear-gradient(135deg, #ff6b6b 0%, #ee5a24 100%);
        color: white;
        border: none;
        border-radius: 10px;
        padding: 1rem;
        margin-bottom: 1rem;
    }

    .form-group label {
        font-weight: 600;
        color: #2c3e50;
    }

    .form-control:focus {
        border-color: #ff6b6b;
        box-shadow: 0 0 0 0.2rem rgba(255, 107, 107, 0.25);
    }
</style>
{% endblock %}

{% block content %}
<div class="row mb-4">
    <div class="col-md-12">
        <h2><i class="fas fa-user-plus"></i> Emergency Patient Registration</h2>
        <p class="text-muted">Register a new emergency patient with vital signs and medical information</p>
    </div>
</div>

<div class="registration-form">
    <form method="post">
        {% csrf_token %}
        
        <!-- Emergency Alert -->
        <div class="alert-emergency">
            <i class="fas fa-exclamation-triangle"></i>
            <strong>Emergency Registration:</strong> Please fill in all required fields. Vital signs can be updated later if not immediately available.
        </div>

        <!-- Patient Information -->
        <div class="form-section">
            <h4 class="section-title"><i class="fas fa-user"></i> Patient Information</h4>
            <div class="row">
                <div class="col-md-6">
                    <div class="form-group">
                        <label for="patient_name">Patient Name *</label>
                        <input type="text" class="form-control" id="patient_name" name="patient_name" required>
                    </div>
                </div>
                <div class="col-md-3">
                    <div class="form-group">
                        <label for="patient_age">Age *</label>
                        <input type="number" class="form-control" id="patient_age" name="patient_age" min="0" max="150" required>
                    </div>
                </div>
                <div class="col-md-3">
                    <div class="form-group">
                        <label for="patient_gender">Gender *</label>
                        <select class="form-control" id="patient_gender" name="patient_gender" required>
                            <option value="">Select Gender</option>
                            <option value="Male">Male</option>
                            <option value="Female">Female</option>
                            <option value="Other">Other</option>
                        </select>
                    </div>
                </div>
            </div>
            <div class="row">
                <div class="col-md-6">
                    <div class="form-group">
                        <label for="patient_mobile">Mobile Number *</label>
                        <input type="text" class="form-control" id="patient_mobile" name="patient_mobile" required>
                    </div>
                </div>
                <div class="col-md-6">
                    <div class="form-group">
                        <label for="emergency_contact">Emergency Contact</label>
                        <input type="text" class="form-control" id="emergency_contact" name="emergency_contact">
                    </div>
                </div>
            </div>
            <div class="row">
                <div class="col-md-8">
                    <div class="form-group">
                        <label for="patient_address">Address *</label>
                        <textarea class="form-control" id="patient_address" name="patient_address" rows="2" required></textarea>
                    </div>
                </div>
                <div class="col-md-4">
                    <div class="form-group">
                        <label for="patient_email">Email</label>
                        <input type="email" class="form-control" id="patient_email" name="patient_email">
                    </div>
                </div>
            </div>
        </div>

        <!-- Emergency Information -->
        <div class="form-section">
            <h4 class="section-title"><i class="fas fa-exclamation-triangle"></i> Emergency Information</h4>
            <div class="row">
                <div class="col-md-6">
                    <div class="form-group">
                        <label for="emergency_type">Type of Emergency *</label>
                        <input type="text" class="form-control" id="emergency_type" name="emergency_type" 
                               placeholder="e.g., Chest Pain, Accident, Fever, etc." required>
                    </div>
                </div>
                <div class="col-md-6">
                    <div class="form-group">
                        <label for="priority">Priority Level *</label>
                        <select class="form-control" id="priority" name="priority" required>
                            <option value="stable">Stable</option>
                            <option value="urgent">Urgent</option>
                            <option value="critical">Critical</option>
                        </select>
                    </div>
                </div>
            </div>
            <div class="form-group">
                <label for="symptoms">Symptoms and Complaints *</label>
                <textarea class="form-control" id="symptoms" name="symptoms" rows="3" 
                          placeholder="Describe the patient's symptoms and complaints..." required></textarea>
            </div>
        </div>

        <!-- Vital Signs -->
        <div class="form-section">
            <h4 class="section-title"><i class="fas fa-heartbeat"></i> Vital Signs</h4>
            <div class="vital-signs-grid">
                <div class="vital-sign-item">
                    <div class="form-group">
                        <label for="blood_pressure_systolic">Blood Pressure (Systolic)</label>
                        <input type="number" class="form-control" id="blood_pressure_systolic" name="blood_pressure_systolic" 
                               placeholder="mmHg" min="50" max="300">
                    </div>
                </div>
                <div class="vital-sign-item">
                    <div class="form-group">
                        <label for="blood_pressure_diastolic">Blood Pressure (Diastolic)</label>
                        <input type="number" class="form-control" id="blood_pressure_diastolic" name="blood_pressure_diastolic" 
                               placeholder="mmHg" min="30" max="200">
                    </div>
                </div>
                <div class="vital-sign-item">
                    <div class="form-group">
                        <label for="heart_rate">Heart Rate</label>
                        <input type="number" class="form-control" id="heart_rate" name="heart_rate" 
                               placeholder="bpm" min="30" max="300">
                    </div>
                </div>
                <div class="vital-sign-item">
                    <div class="form-group">
                        <label for="temperature">Temperature</label>
                        <input type="number" class="form-control" id="temperature" name="temperature" 
                               placeholder="Â°C" min="30" max="45" step="0.1">
                    </div>
                </div>
                <div class="vital-sign-item">
                    <div class="form-group">
                        <label for="respiratory_rate">Respiratory Rate</label>
                        <input type="number" class="form-control" id="respiratory_rate" name="respiratory_rate" 
                               placeholder="breaths/min" min="5" max="60">
                    </div>
                </div>
                <div class="vital-sign-item">
                    <div class="form-group">
                        <label for="oxygen_saturation">Oxygen Saturation</label>
                        <input type="number" class="form-control" id="oxygen_saturation" name="oxygen_saturation" 
                               placeholder="%" min="50" max="100">
                    </div>
                </div>
                <div class="vital-sign-item">
                    <div class="form-group">
                        <label for="blood_sugar">Blood Sugar</label>
                        <input type="number" class="form-control" id="blood_sugar" name="blood_sugar" 
                               placeholder="mg/dL" min="20" max="1000" step="0.1">
                    </div>
                </div>
            </div>
        </div>

        <!-- Medical Information -->
        <div class="form-section">
            <h4 class="section-title"><i class="fas fa-notes-medical"></i> Medical Information</h4>
            <div class="row">
                <div class="col-md-6">
                    <div class="form-group">
                        <label for="allergies">Known Allergies</label>
                        <textarea class="form-control" id="allergies" name="allergies" rows="3" 
                                  placeholder="List any known allergies..."></textarea>
                    </div>
                </div>
                <div class="col-md-6">
                    <div class="form-group">
                        <label for="current_medications">Current Medications</label>
                        <textarea class="form-control" id="current_medications" name="current_medications" rows="3" 
                                  placeholder="List current medications..."></textarea>
                    </div>
                </div>
            </div>
            <div class="form-group">
                <label for="medical_history">Medical History</label>
                <textarea class="form-control" id="medical_history" name="medical_history" rows="3" 
                          placeholder="Relevant medical history..."></textarea>
            </div>
        </div>

        <!-- Staff Information -->
        <div class="form-section">
            <h4 class="section-title"><i class="fas fa-user-md"></i> Staff Information</h4>
            <div class="row">
                <div class="col-md-6">
                    <div class="form-group">
                        <label for="attending_doctor">Attending Doctor</label>
                        <select class="form-control" id="attending_doctor" name="attending_doctor">
                            <option value="">Select Doctor</option>
                            {% for doctor in doctors %}
                            <option value="{{ doctor.id }}">{% if doctor.name|slice:':3'|lower == 'dr.' %}{{ doctor.name }}{% else %}Dr. {{ doctor.name }}{% endif %} - {{ doctor.special }}</option>
                            {% endfor %}
                        </select>
                    </div>
                </div>
                <div class="col-md-6">
                    <div class="form-group">
                        <label for="nurse_staff">Nurse/Staff on Duty</label>
                        <input type="text" class="form-control" id="nurse_staff" name="nurse_staff" 
                               placeholder="Name of nurse or staff member">
                    </div>
                </div>
            </div>
            <div class="form-group">
                <label for="notes">Additional Notes</label>
                <textarea class="form-control" id="notes" name="notes" rows="3" 
                          placeholder="Any additional notes or observations..."></textarea>
            </div>
        </div>

        <!-- Submit Buttons -->
        <div class="row mt-4">
            <div class="col-md-12 text-center">
                <button type="submit" class="btn-emergency">
                    <i class="fas fa-save"></i> Register Emergency Patient
                </button>
                <a href="{% url 'clinic:emergency_services_overview' %}" class="btn-secondary-custom ml-3">
                    <i class="fas fa-times"></i> Cancel
                </a>
            </div>
        </div>
    </form>
</div>

<script>
// Auto-fill current date and time
document.addEventListener('DOMContentLoaded', function() {
    // Priority level styling
    const prioritySelect = document.getElementById('priority');
    const emergencySection = document.querySelector('.form-section:nth-child(2)');
    
    function updatePriorityStyle() {
        emergencySection.className = 'form-section priority-' + prioritySelect.value;
    }
    
    prioritySelect.addEventListener('change', updatePriorityStyle);
    updatePriorityStyle();
});
</script>
{% endblock %} 